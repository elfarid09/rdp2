name: Windows Server RDP Setup

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Set up working directory
        run: |
          mkdir C:\temp -Force
          cd C:\temp

      - name: Download and install components
        run: |
          cd C:\temp
          curl -L -o login.py "https://www.dropbox.com/scl/fi/az5jzhpuiylnw7yqw9du5/login.py?rlkey=1qjxif8fu35dh0v77nagv2ihh&dl=0"
          curl -L -o loop.bat "https://www.dropbox.com/scl/fi/vji7ekyslpbovokpqeay3/loop.bat?rlkey=876nfzm3qdmyqhc1jckgqjcld&dl=0"
          curl -L -o show.bat "https://raw.githubusercontent.com/elfarid09/rdp2/main/show.bat"
          curl -s -L -o C:\Users\Public\Desktop\Telegram.exe "https://telegram.org/dl/desktop/win64"
          curl -s -L -o C:\Users\Public\Desktop\Winrar.exe "https://www.rarlab.com/rar/winrar-x64-621.exe"
          powershell -Command "Invoke-WebRequest 'https://github.com/chieunhatnang/VM-QuickConfig/releases/download/1.6.1/VMQuickConfig.exe' -OutFile 'C:\Users\Public\Desktop\VMQuickConfig.exe'"

      - name: Install RustDesk & Python packages
        run: |
          cd C:\temp
          certutil -urlcache -split -f "https://github.com/rustdesk/rustdesk/releases/download/1.2.1/rustdesk-1.2.1-x86_64.exe" rustdesk.exe
          rustdesk.exe &
          pip install pyautogui --quiet
          pip install pyperclip --quiet
          pip install psutil --quiet

      - name: Run RustDesk and scripts
        run: |
          cd C:\temp
          python login.py
          Start-Process "show.bat"

      - name: Clean Up and Finish
        run: |
          del C:\Users\Public\Desktop\Telegram.exe
          del C:\Users\Public\Desktop\Winrar.exe
          tzutil /s "Sri Lanka Standard Time"
